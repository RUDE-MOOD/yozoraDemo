# ノスタージア WEB3Dのデモです

# TODO LIST
```bash
＝＝＝やり直し＝＝＝
1.ドーム形を立方体にする ✅️
2.レイヤーを積み上げること ✅️

＝＝＝機能系＝＝＝
1.meshを作って一つの星を打ち上げる✅️
2.dreiライブラリのTextを作って星の情報を画面上に表示する✅️
3.UIを追加して、入力欄を追加✅️

4.生成された星をクリックして、詳細情報が表示できるように
5.ディレクトリ構造を整理する(apis,store(zustand?),pages,router,utilsなど)
6.GEMINIのAPIを導入し、ユーザーが書いた日記の感情を分析できるように
7.重み付けのアルゴリズムを作る
8.ユーザー新規登録を実装、supabaseを使ってデータベースを構築する

＝＝＝ビジュアル系＝＝＝
後回し
...
```
## Development Tools
このプロジェクトは **Antigravity + Skills** AI を使用して開発されました。
- **Antigravity**: 高度なエージェントAIによるコーディング支援
- **Skills**: R3F (React Three Fiber) に特化した専門知識モジュール（Geometry, Postprocessing, Shadersなど）を活用し、ベストプラクティスに沿った実装を行っています。



# 環境初期化
1.git cloneまたはソースコードをダウンロードする<br>
2.フォルダーパスのターミナルを開いてyarnでライブラリを初期化（学校のネットワークでうまくできない場合はテザリングなど別のネット環境でリトライ）<br>
3.初期化ができ次第、yarn devで実行する<br>


<h2>レイヤー構造</h2>
<h4>プラネタリウム自体が７つのレイヤーでできている。</h4>
<ol>
  <li>背景（宇宙の色）<br>Three.jsのシェーダー。自由に変えられるようにするため画像を使用しない。</li>
  <li>流体層（天の川風）<br>GPUへの負荷の最小限に抑えるため、ノイズシェーダーを使用。UVマップをゆっくりずらすことで動いているように見せる。</li>
  <li>背景の遠い星 <br>ユーザーが操作しないのでノイズマップですませる。</li>
  <li>霧 <br>さらに立体感を出すためのレイヤー。3Dボリュームでやるとすごく重たくなるのでこれもノイズマップで実現する。深度に応じて透明度の変化もできる。</li>
  <li>星（ユーザーが操作できる）<br>3Dで描画する。InstancedMeshを使用し、独自のシェーダーで光り輝く星（光核＋十字フレア）を表現。個別に色やサイズが異なり、瞬いている。</li>
  <li>ビネット <br>Effectsコンポーネントで実現。</li>
  <li>UI描画 （ユーザーが操作できる）<br>TailwindCSSを用いたHTMLオーバーレイ。グラスモーフィズムデザインで、日記の投稿フォームなどを提供。</li>
</ol>
<p>こういう風にレイヤー毎に分けると、各要素を独立させレイヤー同士の直接依存が生じず拡張性を高めることができる。レイヤー毎の描画トグル・テーマの切り替え・低スペック端末向けのパフォーマンス描画モードも実装可能。</p>

# コンポーネント
## Experience
各コンポーネントを組み立てるためのメインコンテナ。
CameraControlsを使用し、ズームや移動の制限（最小・最大距離、パン範囲）を設定済み。
スマホなどのタッチ操作（ピンチズーム）にも対応。


## Effects
`@react-three/postprocessing`を使用した映像効果を担当。
- **Bloom**: 星の輝きを強調し、光暈（ハロー）を追加。
- **Noise**: フィルムライクな粒子感を加え、デジタル的な冷たさを軽減。
- **Vignette**: 画面四隅を減光させ、視線を中央へ誘導しつつ没入感を高める。
- **ToneMapping**: HDRレンダリングの色調を補正（ACESFilmic）し、白飛びを抑えつつコントラストを確保。

## SkyBox
以前のSkydome（半球体）から変更し、複数の平面レイヤーを重ねた構造（Cuboid的アプローチ）。
以下の4層で深みのある夜空を表現：
1. **Background**: 宇宙のベースカラー
2. **Fluid**: 天の川のような流体ノイズ
3. **Stars**: 瞬く遠景の星々
4. **Fog**: 奥行きを出すための霧
各レイヤーは専用のシェーダーで描画され、軽量かつ表現豊かに実装。


## MyStars
レイヤー5に相当する、ユーザー自身の星を描画するコンポーネント。
- **InstancedMesh**: 1000個以上の星を軽量に描画するためにインスタンシング技術を使用。
- **Custom Shader**: 円形の光核と十字のレンズフレア（光条）を持つ独自のシェーダーで描画。
- **Attributes**: 星ごとに個別の位置、色（青、シアン、ゴールド、ピンク）、サイズ、瞬きのタイミング（位相）を持つ。
- **Billboarding**: シェーダー内で頂点計算を行い、常にカメラの方を向くように制御。

## UI
HTMLオーバーレイとして実装されたユーザーインターフェース。
- **TailwindCSS**: グラスモーフィズム（すりガラス）デザインを採用し、夜空の雰囲気にマッチさせた。
- **Components**:
    - **Menu Button**: 画面右上に配置された3点リーダーボタン。
    - **Diary Modal**: 「日記を書く」を選択すると出現する入力フォーム。テキスト入力時に文字がふわっと現れるアニメーション演出付き。
- **App Integration**: `<Canvas>`の外側に配置され、3Dシーンの上に重なって表示される。

## UserAddedStars
ユーザーが日記を書くことで追加される星のレイヤー。
- **User Interaction**: UIの日記フォームから送信されたデータに基づき、リアルタイムに生成される。
- **Properties**: 
    - **Randomness**: 位置、色、サイズ、瞬きのパターンがランダムに割り当てられる。
    - **Date Label**: `@react-three/drei`の`Text`コンポーネントを使用し、星の下に生成日時（例: "26/1/26 16:25"）を表示。
- **Camera Integration**: 生成エリアはカメラの移動制限範囲内に収まるように計算されており、確実に近づいて鑑賞できる。

# 日記から星へ
「日記を書く」ことは、ただ記録を残すだけでなく、夜空に新しい星を打ち上げる行為としてデザインされています。

1. **Input**: ユーザーがUIの日記モードでテキストを入力し、「送信」を押す。
2. **State Update**: `App.jsx`で管理されている`userStars`ステートに、新しい星のデータ（日時、ランダムな座標・色・サイズ）が追加される。
3. **Render**: 
   - `Experience`コンポーネント内の`UserAddedStars`が更新を検知。
   - 新しい`UserStar`コンポーネントが3D空間上の指定座標に出現。
   - 独自のシェーダーマテリアルで輝き始め、ビルボード化されたテキストで日付が表示される。
4. **Result**: ユーザーの想い（日記）が、可視化された「星」となってプラネタリウムの一部になる。
